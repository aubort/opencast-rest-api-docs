<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>${meta.title} REST Documentation</title>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="main.css">
  </head>

<style>
html, body {
  font-family: "Open Sans",Helvetica,sans-serif;
  font-size: 16px;
  max-width:800px;
  margin: 20px 20px;
  color: #474a54;
}

h1 {
  font-size: 25px;
  font-weight: 100;
  color: #444;
  line-height:35px;
  margin-top: 30px;
}

hr {
  margin-top: 20px;
  margin-bottom: 20px;
  border: 0;
  border-top: 1px solid #eeeeee;
}

p {
    line-height: 24px;
    margin: 0;
    margin-bottom: 24px;
}


ul, li {
    line-height: 24px;
    list-style: disc;
    font-weight: 400;
}

a {
    color: #3367d6;
    text-decoration: none;
}

table tr, td, th, tbody{
  padding: 6px 10px;
  border: 1px solid #DDDDDD;
}

table {
  border-collapse: collapse;
  border-spacing: 1px;
  width:100%;
}

table th{
  background-color: #6199DF;
  color: white !important;
  border-color: #6199DF;
}

.e-type {
  display: inline-block;
  padding: 2px 3px 1px 3px;
  font-size: 14px;
  font-weight: 400;
  line-height: 16px;
  color: #fff;
  text-shadow: 0 -1px 0 rgba(0,0,0,0.25);
  white-space: nowrap;
  vertical-align: middle;
  background-color: #999;
  border-radius: 2px;
}

.e-type.t-GET{
  background-color: #10a54a;
}

.e-type.t-POST{
  background-color: #0f6ab4;
}

.e-type.t-PUT{
  background-color: #c5862b;
}

.e-type.t-DELETE{
  background-color: #a41e22;
}

</style>


  <body>


<!--  SAMPLE TABLE    -->
<!--
      <table>
            <thead>
            <tr>
                <th align="left">Parameter</th>
                <th align="left">Type</th>
                <th align="left">Description</th>
            </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="left"><code>sign</code></td>
                    <td align="left">boolean</td>
                    <td align="left">Whether public distribution urls should be signed.</td>
                </tr>
                <tr>
                    <td align="left"><code>sign</code></td>
                    <td align="left">boolean</td>
                    <td align="left">Whether public distribution urls should be signed.</td>
                </tr>
            </tbody>
        </table>
-->
<!-- END SAMPLE TALBE     -->

<!-- Sample list -->
<!-- <ul>
    <li><a href="#get-apievents">GET /api/events</a></li>
    <li><a href="#post-apievents">POST /api/events</a></li>
    <li><a href="#get-apieventevent_id">GET /api/event/{event_id}</a></li>
    <li><a href="#put-apieventsevent_id">PUT /api/events/{event_id}</a></li>
    <li><a href="#delete-apieventsevent_id">DELETE /api/events/{event_id}</a></li>
</ul> -->

<!-- Sample headings -->

<h1 id="GET-/admin-ng/event/{eventId}/attachments.json">
  <span class="e-type t-GET">GET</span>
  /admin-ng/event/{eventId}/attachments.json
</h1>
<hr>
<h1 id="POST-/admin-ng/event/{eventId}/transitions">
  <span class="e-type t-POST">POST</span>
  /admin-ng/event/{eventId}/transitions
</h1>



    <#list endpointHolders as endpointHolder>
      <#if (endpointHolder.endpoints?size > 0)>
        <!--   TOC     -->
        <ul>
            <#list endpointHolder.endpoints as endpoint>
              <li><a href="#${endpoint.method}-${meta.url}${endpoint.path}">${endpoint.method} ${meta.url}${endpoint.path}</a></li>
            </#list>
        </ul>

        <#list endpointHolder.endpoints as endpoint>

        <!-- title and description -->
            <h1 id="${endpoint.method}-${meta.url}${endpoint.path}">
              <span class="e-type t-${endpoint.method}">${endpoint.method}</span>
              ${meta.url}${endpoint.path}
            </h1>
            <hr />
            <p>${endpoint.description!"&nbsp;"}</p>
            <#if (endpoint.pathParams?size > 0)>
            <!-- Table listing all the Path Params -->
                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <!-- <th>Type</th> -->
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <#list endpoint.pathParams as param>
                            <tr>
                                <td align="left"><code>${param.name}</code></td>
                                <!-- <td align="left"></td> -->
                                <td align="left">
                                  ${param.description!"&nbsp;"}
                                  <#if param.defaultValue??><br />Default value=${param.escapedDefaultValue}</#if>
                                </td>
                            </tr>
                        </#list> <!-- endpoint.pathParams as param -->
                    </tbody>
                </table>
            </#if> <!-- endpoint.pathParams -->

            <!-- Form Params table header -->

            <#if (endpoint.requiredParams?size > 0) || (endpoint.optionalParams?size > 0)>
              <p> Form Params</p>
              <table>
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <!-- <th>Type</th> -->
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
            </#if>
            <!-- Form Params required -->
            <#if (endpoint.requiredParams?size > 0)>
              <#list endpoint.requiredParams as param>
                <tr>
                    <td align="left"><code>${param.name}</code></td>
                    <!-- <td align="left"></td> -->
                    <td align="left">
                      ${param.description!"&nbsp;"}
                      <#if param.defaultValue??><br />Default value=${param.escapedDefaultValue}</#if>
                    </td>
                </tr>
              </#list>
            </#if>
            <#if (endpoint.optionalParams?size > 0)>
              <#list endpoint.optionalParams as param>
                <tr>
                    <td align="left"><code>${param.name}</code></td>
                    <!-- <td align="left"></td> -->
                    <td align="left">
                      ${param.description!"&nbsp;"}
                      <#if param.defaultValue??><br />Default value=${param.escapedDefaultValue}</#if>
                    </td>
                </tr>
              </#list>
            </#if>
                  </tbody>
              </table>
        </#list>
      </#if>
    </#list>

    <!-- JAVASCRIPT below here -->
<!--    <script type="text/javascript" src="js/jquery/jquery.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">
    /*global alert, jQuery  */
    (function($) {

        $("a.show_form_link").click(
            function() {
               var $this = $(this);
               var $form = $this.parent().find("div.hidden_form");
               var $hidectrl = $this.parent().find("a.hide_form_link");
               $form.toggle(400);
               $hidectrl.show();
               $this.parent().find("div.form_submit input[type='button']").click(
                  function() {
                     $form.hide(200);
                     $this.show();
                  }
               );
               $this.hide();
               return false;
            }
        );

        $("a.hide_form_link").click(
            function() {
               var $this = $(this);
               var $form = $this.parent().find("div.hidden_form");
               var $show_form_ctrl = $this.parent().find("a.show_form_link");
               $form.hide(200);
               $show_form_ctrl.show();
               $this.hide();
               return false;
            }
         );

        /**
         * Takes a path and integrates the pathParams values into it
         * @param {String} path the path with keys (e.g. /my/{thing}/{stuff})
         * @param {Array} params the params to put into the path (e.g. {'thing':'apple'})
         */
        function updatePath(path, params) {
            var newPath = path;
            for (var key in params) {
                if (params.hasOwnProperty(key)) {
                    var value = params[key];
                    if (value !== undefined && value !== null && value !== '') {
              // The Regex here handles syntax like /episode.{format:xml|json}.
              // In this case, the {format:xml|json} part is extracted, then
              // the xml|json part is used as the second regex to verify user's input.
              // If the input is valid, the path /episode.{format:xml|json} would be
              // replaced by /episode.xml for example.
                        var regex = new RegExp( "{" + key + "(:[^}]*|)}", "");
                        if (regex.test(newPath))
                        {
                             var pat = regex.exec(newPath)[1].substring(1);
                             var regex2 = new RegExp(pat, "");
                             if (regex2.test(value))
                             {
                               newPath = newPath.replace(regex, value);
                             } else
                             {
                               alert('The value for ' + key + ' is invalid.');
                             }
                        } else
                        {
                             alert("wrong syntax");
                        }
                    }
                }
            }
            return newPath;
        }

        function checkPath($form) {
            var params = [];
            $form.find(".form_param_path").each( function() {
                var $param = $(this);
                params[$param.attr('name')] = $param.val();
            });
            var form_path = $form.find("input.form_action_holder").val();
            var path = updatePath(form_path, params);
            // update form and display
            $form.attr('action', path);
            $form.find(".form_path").html(path);
            if (path.indexOf("{") >= 0 && path.indexOf("}") >= 0) {
                return false;
            }
            return true;
        }
        function checkRequired($form) {
            // check all required items
            var $required = $form.find(".form_param_required");
            var total = $required.length;
            var counter = 0;
            $required.each( function() {
                var $this = $(this);
                if ($this.val() !== null && $this.val() !== '') {
                    counter++;
                }
            });
            var $formInputs = $form.find("div.form_submit input");
            if (counter >= total) {
                // submit is ok
                $formInputs.removeAttr('disabled');
                return true;
            } else {
                // disable form submit until required options at set
                $formInputs.attr('disabled', 'disabled');
                return false;
            }
        }
        // do operation on all testing forms
        $("form.form_test_form").each( function() {
            var $form = $(this);
            if ($form.find("input.form_action_holder").length >= 1) {
                // now find and put the event handler on all path params
                $form.find(".form_param_path").change( function() {
                    checkPath($form);
                });
                // run the checkPath method
                checkPath($form);
                var $reqParams = $form.find(".form_param_required");
                if ($reqParams.length > 0) {
                    // add required options checks
                    $reqParams.change( function(){
                        checkRequired($form);
                    });
                }
                // run the check required
                checkRequired($form);
                // handle the ajax submissions
                if ($form.find("input.form_ajax_submit").length >= 1) {
                  // the form will use ajax submit
                  //var form_key = $form.find("input.form_endpoint_name").val();
                  // add an event handler to the form submit
                  $form.bind('submit', function() {
                      if ( checkRequired($form) ) {
                          var submitParams = {};
                          $form.find(".form_param_submit").each( function() {
                              var $param = $(this);
                              var $value = $param.val();
                              if (this.type == 'checkbox' && !this.checked) {
                                $value = "false";
                              }
                              submitParams[$param.attr('name')] = $value;
                          });
                          //alert("params: " + $.param(submitParams));
                          var method = $form.find(".form_method").val();
                          var url = $form.attr('action');
                          $form.parent().find(".test_form_working").show();
                          $form.parent().find(".test_form_response input").click(function(){
                              $(this).parent.hide();
                              $this.parent().find("a.hide_form_link").hide();
                          });

                          // clear previous responses
                          var responseBody = $form.parent().find(".test_form_response");
                          responseBody.hide();
                          responseBody.find("pre").text("");

                          // make the request
                          $.ajax({
                              type: method,
                              url: url,
                              processData: true,
                              dataType: 'text',
                              data: submitParams,
                              success: function(data, textStatus, request) {
                                  $form.parent().find(".test_form_working").hide();
                                  var responseBody = $form.parent().find(".test_form_response");
                                  responseBody.show();
                                  var msg = "Status: " + request.status + " (" + request.statusText + ")\n\n" + data;
                                  responseBody.find("pre").text(msg);
                              },
                              error: function(request, textStatus, errorThrown) {
                                  $form.parent().find(".test_form_working").hide();
                                  var responseBody = $form.parent().find(".test_form_response");
                                  var msg = "Status: " + request.status + " (" + request.statusText + ")";
                                  responseBody.show();
                                  responseBody.find("pre").text(msg);
                              }
                          });
                      } else {
                          alert("Fill out all required fields first");
                      }
                      return false;
                  });
                }
            }
        });
    }(jQuery));
    </script>
  </body>
</html>
